var idg=idg||{};idg.init=function(){new idg.NavBtnPopup("logo",$("#js-openeyes-btn"),$("#js-openeyes-info")),new idg.NavBtnPopup("shortcuts",$("#js-nav-shortcuts-btn"),$("#js-nav-shortcuts-subnav")).useWrapper($("#js-nav-shortcuts"));var t=new idg.NavBtnPopup("activity",$("#js-nav-activity-btn"),$("#js-activity-panel"));if(!$("#oescape-layout").length){i(),$(window).resize(function(){i()});function i(){$(window).width()>1800?t.fixed(!0):t.fixed(!1)}}idg.patientPopups.init(),idg.collapseGroups(),idg.lighteningViewer(),idg.tooltips(),idg.overlayPopup(".js-demo-open-eyedraw-app","eyedraw-edit-app.php","#js-demo-eyedraw-app-close"),idg.overlayPopup("#js-add-new-event","add-new-event.php",".close-icon-btn",function(t){t.find(".step-3").click(function(){window.location=$(this).data("url")})});idg.examElementSearchPopup(),idg.sidebarQuickInfo(),idg.comments(),idg.elementAddSearchType()};var clinic=clinic||{};clinic.init=function(t){this.data=t,this.activePathwayID=0,this.activePathwayName="",$(".js-add-pathway").click(function(t){t.stopPropagation(),clinic.activePathwayID=$(this).data("id"),clinic.activePathwayName=$(this).data("name");var i=clinic.getPosition($(this));clinic.addPathway.show(i.left,i.top-15)}),$(".oe-clinic-list .pathway-step").each(function(){clinic.makeDefaultStep($(this));var t=$(this).attr("class").split(" ");void 0==$(this).data("data")?$(this).data("data",clinic.createDefaultData(t[1])):$(this).data("data").state=clinic.setState(t[1])}),$(".oe-clinic-filter").click(function(t){t.stopPropagation(),clinic.filterList($(this))}),this.setupDemoUI(),this.setupAddToAll(),this.setupAddPathway(),this.setupActiveInfo(),this.setupAssignments(),this.setupFilters(),this.setDurationGraphics(),this.showCurrentTime(),this.quicklook()},clinic.setupActiveInfo=function(){$("#js-active-step-info .close-icon-btn").click(function(t){t.stopPropagation(),clinic.activeInfo.hide()}),$("#js-activate-task").click(function(t){clinic.activeInfo.activate()}),$("#js-submit-pin-right").click(function(t){clinic.activeInfo.pin($("#js-user-pin-right").val(),"right")}),$("#js-submit-pin-left").click(function(t){clinic.activeInfo.pin($("#js-user-pin-left").val(),"left")}),$("#js-trash-active-step").click(function(t){clinic.activeInfo.removeStep()}),clinic.activeInfo={activeStep:null,removeStep:function(){this.activeStep.remove(),this.hide()},activate:function(){clinic.makeStepActive(this.activeStep),this.hide()},pin:function(t,i){"1234"===t?(clinic.stepComplete(this.activeStep),this.hide()):($(".eye-confirmation."+i).addClass("wrong-pin"),$("#js-user-pin-"+i).focus())},show:function(t,i,e){clinic.addPathway.hide(),$(".eye-confirmation").removeClass("wrong-pin"),this.activeStep=e;var n=e.data("data");$("#js-active-step-info .title").text(n.n),$("#js-active-step-info .eye .side").text(n.eye),$("#js-active-step-info .data").html(n.t),$("#js-active-step-info").removeClass("hidden").show().css({left:t,top:i}),$("#js-activate-task").hide(),$("#js-pin-confirmation").hide(),$("#js-who-completed").hide(),$("#js-trash-active-step").show();switch(n.state){case"ready":$("#js-activate-task").show();break;case"active":$("#js-pin-confirmation").show(),function(t){switch(t=t.toLowerCase()){case"right":$("#js-pin-confirmation .eye-confirmation.left").hide(),$("#js-pin-confirmation .eye-confirmation.right").show();break;case"left":$("#js-pin-confirmation .eye-confirmation.left").show(),$("#js-pin-confirmation .eye-confirmation.right").hide();break;default:$("#js-pin-confirmation .eye-confirmation.left").show(),$("#js-pin-confirmation .eye-confirmation.right").show()}}(n.eye);break;case"complete":$("#js-who-completed").show(),$("#js-trash-active-step").hide()}},hide:function(){this.activeStep=null,$(".input-confirmation").removeClass("wrong-pin"),$("#js-active-step-info").hide()}}},clinic.setupAddPathway=function(){$("#js-add-new-pathway .close-icon-btn").click(function(t){t.stopPropagation(),clinic.addPathway.hide()}),$("#js-add-new-pathway .next-step-add").click(function(t){t.stopPropagation(),clinic.addPathway.addStep($(this))}),$("#js-dilate-add-btn").click(function(i){i.stopPropagation(),function(){var i=clinic.addPathway.selectedStep,e={},n=!!clinic.addPathway.makeActive||clinic.isNewStepActive(),a=$("input[name=eye]:checked").val();e.eye=a;var s=$("input[name=fixed]:checked").val();if(void 0!==s){e.n="Fixed Dilate Set",e.t=s;i.clone();t(clinic.createNewStep(i,e,n)),t(clinic.createNewStep(i,e,n)),t(clinic.createNewStep(i,e,n)),clinic.addPathway.reset()}else{var c=$(".option-list input:checkbox:checked");if(c.length){e.n="Dilate",e.t="";for(var o=0;o<c.length;o++)e.t+=c[o].value+"<br>";t(clinic.createNewStep(i,e,n)),clinic.addPathway.reset()}}}()}),$("#js-pathway-back").click(function(t){t.preventDefault(),t.stopPropagation(),clinic.addPathway.back()}),$("#js-pathway-back").hide();function t(t){$("#patient-"+clinic.activePathwayID+" .pathway").append(t),clinic.updateTasks()}clinic.addPathway={selectedStep:null,makeActive:!1,show:function(t,i){clinic.activeInfo.hide(),$("#js-add-new-pathway").removeClass("hidden").show().css({left:t,top:i}),$("#js-add-new-pathway .title").text(clinic.activePathwayName)},addStep:function(i){if(this.makeActive=1==$(".make-active input:checkbox:checked").length,$(".make-active input").prop("checked",!1),"dilate"==i.data("id"))this.selectedStep=i,this.showDilateOptions();else{var e=!!this.makeActive||clinic.isNewStepActive(),n=clinic.createDefaultData("next-step");t(clinic.createNewStep(i,n,e)),this.selectedStep=null}},showDilateOptions:function(){$("#js-add-new-pathway .oec-new-pathway-steps").hide(),$("#add-dilate-options").removeClass("hidden").show(),$("#js-pathway-events-title span").hide(),$("#js-pathway-back").show()},back:function(){$("#js-add-new-pathway .oec-new-pathway-steps").show(),$("#add-dilate-options").hide(),$("#js-pathway-events-title span").show(),$("#js-pathway-back").hide()},reset:function(){$("#add-dilate-options .option-list input").prop("checked",!1),$("#add-dilate-options").hide(),$("#js-add-new-pathway .oec-new-pathway-steps").show(),$("#js-pathway-events-title span").show(),$("#js-pathway-back").hide()},hide:function(){this.reset(),$("#js-add-new-pathway").hide()}}},clinic.setupAddToAll=function(){$("#js-add-to-all-pathways .close-icon-btn").click(function(t){t.stopPropagation(),clinic.addToAll.hide()}),$("#js-add-to-all").on("click",function(t){t.stopPropagation(),clinic.addToAll.show()}),$("#js-add-all-set-btn").click(function(e){e.stopPropagation(),function(){var e=$("#js-add-to-all-pathways input[name=userset]:checked").val();if(void 0!==e&&1==e){var n=clinic.createPathwayStep("VA");clinic.makeDefaultStep(n),n.data("data",{eye:"left",n:"Visual Acuity",t:"In progress",state:"ready"});var a=clinic.createPathwayStep("Dilate");clinic.makeDefaultStep(a),a.data("data",{eye:"left",n:"Dilate",t:"Tropicamide",state:"ready"});var s=n.add(a);t(i,s)}}()}),$("#js-add-to-all-pathways .next-step-add").click(function(e){e.stopPropagation(),n=$(this),t(i,clinic.createNewStep(n,clinic.createDefaultData("next-step")));var n}),$("#js-add-to-all-pathways .select-deselect-all input").change(function(){$(".js-add-all-select").prop("checked",this.checked)});function t(t,i){$(".oe-clinic-list tbody tr").each(function(){var e=$(this).data("state");"active"!=e&&"inactive"!=e||t(this,i)})}function i(t,i){var e=$(".js-add-all-select",t).is(":checked"),n=$(t).is(":hidden");if(e&&!n){var a=$(".pathway-step",t).last().hasClass("green"),s=i.clone(!0);if(a){var c=s.first();clinic.makeDefaultStep(c),clinic.makeStepActive(c)}$(".pathway",t).append(s),clinic.updateTasks()}}function e(t){$(".js-add-pathway",t).hide(),$(".js-add-all-select",t).removeClass("hidden").prop("checked",!0).show()}function n(t){$(".js-add-pathway",t).show(),$(".js-add-all-select",t).hide()}clinic.addToAll={show:function(){clinic.addPathway.hide(),$("#js-add-to-all-pathways").removeClass("hidden").show(),$("#js-add-to-all-pathways .select-deselect-all input:checkbox").prop("checked",!0),t(e)},hide:function(){t(n),$("#js-add-to-all-pathways").hide()}}},clinic.changeAssignment=function(t,i,e){e=parseInt(e);var n=clinic.data[t].indexOf(e);n>-1&&clinic.data[t].splice(n,1),clinic.data[i].push(e),a(t),a(i);function a(t){$("#filter-"+t+" .current").text(clinic.data[t].length)}},clinic.createDefaultData=function(t){return{eye:"Both",n:"Not Set",t:"Currently no data is being generated for this step",state:clinic.setState(t)}},clinic.createNewStep=function(t,i,e){void 0===e&&(e=!1);var n=$.extend({},i),a=t.clone();return a.removeClass("next-step-add"),clinic.makeDefaultStep(a),a.data("data",n),e&&clinic.makeStepActive(a),a},clinic.createPathwayStep=function(t){var i=$("<span>",{class:"pathway-step"});return i.text(t),i.append('<span class="time"></span>'),i},clinic.filterList=function(t){var i=t.data("id");if($(".oe-clinic-filter").removeClass("selected"),$("#filter-"+i).addClass("selected"),"all"==i)$(".oe-clinic-list tbody tr").show();else{$(".oe-clinic-list tbody tr").hide();for(var e=clinic.data[i],n=0;n<e.length;n++)$("#patient-"+e[n]).show()}},clinic.getPosition=function(t){var i=t.position(),e=$(".oe-clinic-list").position();return i.top=i.top-e.top,i},clinic.isNewStepActive=function(){return!!$("#patient-"+clinic.activePathwayID+" .pathway-step").last().hasClass("green")},clinic.makeDefaultStep=function(t){t.addClass("next-step"),t.click(function(t){t.stopPropagation();var i=clinic.getPosition($(this));clinic.activeInfo.show(i.left,i.top,$(this))})},clinic.makeStepActive=function(t){t.data("data").state="active",t.removeClass("next-step").addClass("orange"),clinic.updateTasks()},clinic.makeStepComplete=function(t){t.data("data").state="complete",t.removeClass("orange").addClass("green"),t.children(".time").text("10:35"),clinic.updateTasks()},clinic.quicklook=function(){var t=$("#patient-clinic-quicklook");$(".js-clinic-quicklook").click(function(i){i.stopPropagation();var e=clinic.getPosition($(this));!function(i,e){offsetTop=e+30,t.find(".patient-details .name").text(i.data("name")),t.find(".patient-details .number").text(i.data("id")),i.find(".triangle").length?t.find(".alert-box").show():t.find(".alert-box").hide();t.removeClass("hidden").css({top:offsetTop}).show()}($(this),e.top)}),t.click(function(i){i.stopPropagation(),t.hide()})},clinic.setDurationGraphics=function(){$(".duration-mins").each(function(){var t=parseInt($(this).text());if(t>0){var i=$(this).parent().children(".duration-graphic");t>90?i.children(".c4").css({fill:"#f00"}):t>60?i.children(".c3").css({fill:"#f60"}):t>40?i.children(".c2").css({fill:"#ebcd00"}):i.children(".c1").css({fill:"#0c0"})}})},clinic.setState=function(t){var i;switch(t){case"next-step":i="ready";break;case"orange":i="active";break;case"green":case"blue":i="complete";break;case"dna":i="dna"}return i},clinic.setupAssignments=function(){$(".clinic-assign-options").each(function(){var t=$(this).val();$(this).data("previous",t)}),$(".clinic-assign-options").change(function(){var t=$(this).data("id");clinic.changeAssignment($(this).data("previous"),this.value,t),$(this).data("previous",this.value)})},clinic.setupDemoUI=function(){$(".pathway").each(function(){if($(this).children(".pathway-step").first().hasClass("dna")){var t=$(this).parents("tr");t.data("state","dna"),t.find(".clinic-assign-options").hide(),t.find(".js-add-pathway").hide(),t.find(".duration-graphic").css("opacity","0.3"),t.find(".duration-mins").hide()}});(e=$("#patient-1152572")).data("state","complete");var t=e.find(".duration-graphic"),i=t.parent();t.hide(),i.addClass("complete"),i.children(".duration-mins").append(" mins"),e.find(".clinic-assign-options").hide(),e.find(".clinic-assign-options").parent().text("Dr Amit Baum (AB)"),e.find(".js-add-pathway").hide(),$("#filter-AB .total").text(1);(e=$("#patient-1008002")).find(".js-clinic-quicklook").append('<i class="oe-i triangle active inline small">');var e;(e=$("#patient-1897143")).find(".js-clinic-quicklook").append('<i class="oe-i triangle active inline small">')},clinic.setupFilters=function(){$("#filter-all").addClass("selected");for(obj in clinic.data){var t=clinic.data[obj],i=obj.toString();if($("#filter-"+i+" .current").text(t.length),"dna"!=obj&&"tasks"!=obj)for(var e=0;e<t.length;e++)$("#patient-"+t[e]+" .clinic-assign-options").val(i)}$(".clinic-assign-options").each(function(){if("unassigned"==$(this).val()&&$(this).is(":visible")){var t=$(this).parents("tr").data("id");clinic.data.unassigned.push(parseInt(t))}}),$("#filter-unassigned .current").text(clinic.data.unassigned.length)},clinic.showCurrentTime=function(){var t=!1;$(".oe-clinic-list tbody tr").each(function(){var i=$(this).find("td").first();if("10:35"==i.text()){t=!0;var e=clinic.getPosition(i);$(".clinic-time").css({top:e.top-7})}t&&$(this).addClass("future")})},clinic.stepComplete=function(t){clinic.makeStepComplete(t);var i=t.next();i.length&&i.hasClass("next-step")&&clinic.makeStepActive(i)},clinic.updateTasks=function(){$("#js-clinic-list-patients tr").each(function(){if("active"==$(this).data("state")){var t=parseInt($(this).data("id")),i=clinic.data.tasks.indexOf(t);$(".pathway-step.orange",this).length?-1==i&&clinic.data.tasks.push(t):i>-1&&clinic.data.tasks.splice(i,1)}}),$("#filter-tasks .current").text(clinic.data.tasks.length)};var oes={init:function(){$("#js-exit-oescape").click(function(){window.location=document.referrer})}};oes.initStack=function(t,i,e){var n=1,a=(t=$(t)).children().length;$(t).bind("mousemove touchmove",function(t){t.stopPropagation();var i=$(this).offset(),n=t.pageX-i.left,c=$(this).width(),o=Math.ceil(n/(c/a));0===o||o>a||(s(o),"function"==typeof e&&e(o))});function s(t){$(i+n).hide(),$(i+t).removeClass("hidden").show(),n=t}return{setImg:function(t){s(t),t=t}}},oes.setupAreaTabButtons=function(t,i){for(var e=0;e<t.length;e++)new n(t[e].btn=$(t[e].btn),t[e].content=$(t[e].content),e);t[0].btn.addClass("selected");function n(e,n,a){n=n,a=a;(e=e).click(function(e){e.stopPropagation(),function(){for(var i=0;i<t.length;i++)t[i].btn.removeClass("selected"),t[i].content.hide()}(),$(this).addClass("selected"),n.removeClass("hidden").show(),"function"==typeof i&&i(a)})}},oes.setupResizeButtons=function(t){var i,e=$(".oes-left-side"),n=$(".oes-right-side");$(".js-oes-area-resize").click(function(a){a.stopPropagation();switch($(this).data("area")){case"small":i=500;break;case"medium":i=700;break;case"large":i=900;break;case"full":i=null}null==i?(e.css({"min-width":"500px",width:"100%"}),n.hide()):(e.css({"min-width":i+"px",width:""}),n.show()),"function"==typeof t&&t(i)})},idg.lighteningViewer=function(){"/v3.0/lightening-letter-viewer"!=window.location.pathname?$("#js-lightening-viewer-btn").click(function(t){t.stopPropagation(),window.location="/v3.0/lightening-letter-viewer"}).mouseenter(function(){$(this).addClass("active")}).mouseleave(function(){$(this).removeClass("active")}):$("#js-lightening-viewer-btn").addClass("active")},idg.patientPopups={init:function(){if(0!=$("#oe-patient-details").length){var t=[new idg.NavBtnPopup("quicklook",$("#js-quicklook-btn"),$("#patient-summary-quicklook")),new idg.NavBtnPopup("demographics",$("#js-demographics-btn"),$("#patient-popup-demographics")),new idg.NavBtnPopup("risks",$("#js-allergies-risks-btn"),$("#patient-popup-allergies-risks")),new idg.NavBtnPopup("tasks",$("#js-tasks-btn"),$("#patient-popup-tasks"))];for(pBtns in t)t[pBtns].inGroup(this);this.popupBtns=t,$("#problems-plans-sortable").length&&idg.problemsPlans()}},closeAll:function(){for(pBtns in this.popupBtns)this.popupBtns[pBtns].hide()}},idg.problemsPlans=function(){var t=document.getElementById("problems-plans-sortable");Sortable.create(t);$("#js-add-pp-btn").click(function(){var t=$("#create-problem-plan"),i=t.val();if(""!==i){var e='<li><span class="drag-handle">&#9776;</span>'+i+'<div class="remove">&times;</div></li>';$("#problems-plans-sortable").append(e),t.val("")}}),$("#problems-plans-sortable .remove").click(function(){$(this).parent().remove()})},idg.elementAddSearchType=function(){$(".js-add-select-type").each(function(){new function(t,i){i.removeClass("hidden").hide();var e=i.find(".type-search-autocomplete"),n=i.find(".type-search-results"),a=i.find(".oe-add-select-type-cancel");t.click(function(t){t.stopPropagation(),i.show(),n.hide(),e.keypress(function(){"au"===e.val()&&n.show()})});i.find(".oe-ast-options > li").click(function(){s()}),a.click(function(){s()});function s(){n.hide(),e.val(""),i.hide()}}($(this),$(this).parent().children(".oe-add-select-type"))})},idg.examElementSearchPopup=function(){null!==document.getElementById("elements-search-results")&&($("#js-element-search-right").focus(function(){t()}).focusout(function(){$(this).val("")}),$("#js-element-search-left").focus(function(){t()}).focusout(function(){$(this).val("")}));function t(){$("#elements-search-results").show(),$(".lvl1").click(function(){$("#elements-search-results").hide()}),$(".close-icon-btn").click(function(){$("#elements-search-results").hide()})}},idg.sidebarQuickInfo=function(){if(0!=$(".events").length){$(".events .event").each(function(){new function(e,n){e.hover(function(){n.removeClass("hidden").show(),e=$(this).data("id"),a=$(this).data("date"),i.stop().fadeIn(50),$("#quickview-"+t).hide(),$("#quickview-"+e).show(),$("#js-quickview-date").text(a),t=e;var e,a},function(){n.hide(),i.stop().fadeOut(150)})}($(".event-type",this),$(".quicklook",this))}),$("[id^=quickview]").hide();var t=null,i=$("#js-event-quickview")}},idg.NavBtnPopup=function(t,i,e){var n=i,a=!1,s=!1,c=null,o=!1,l={active:"active",open:"open"};this.hide=h,this.useWrapper=function(t){n.off("click mouseenter mouseleave"),n=t,l.open=l.active,a=!0,d()},this.fixed=function(t){o=t,t?(e.off("mouseenter mouseleave"),p()):h()},this.inGroup=function(t){s=!0,c=t},d();function d(){n.click(function(t){t.stopPropagation(),function(t){if(o)return;t?h():(s&&c.closeAll(),p())}(i.hasClass(l.open))}).mouseenter(function(){i.addClass(l.active),a&&p()}).mouseleave(function(){i.removeClass(l.active),a&&h()})}function p(){i.addClass(l.open),e.show(),a||o||e.mouseenter(function(){$(this).off("mouseenter"),$(this).mouseleave(function(){$(this).off("mouseleave"),h()})})}function h(){i.removeClass(l.open),e.hide()}},idg.collapseGroups=function(){$(".collapse-group").each(function(){new function(t,i,e,n){var a=t,s=i,c=e,o="expanded"==n;a.click(function(){l()}),s.click(function(){l()});function l(){o?c.hide():c.removeClass("hidden").show(),a.toggleClass("minus plus"),o=!o}}($(this).find(".collapse-group-icon .oe-i"),$(this).find(".collapse-group-header"),$(this).find(".collapse-group-content"),$(this).data("collapse"))})},idg.comments=function(){$(".js-add-comments").click(function(t){t.stopPropagation(),$(this).hide();var i=$(this).data("input");"next"==i?$(this).next().removeClass("hidden").focus():$(i).removeClass("hidden").focus()})},idg.overlayPopup=function(t,i,e,n){$(t).length&&$(t).click(function(t){t.stopPropagation(),function(){var t=$("<div>");t.addClass("oe-popup-wrap"),t.load("/php/v3.0/_load/"+i,function(){i=$(e,this),a=$(this),i.click(function(){a.remove()});var i,a;n&&n(t)}),$("body").prepend(t)}()})},idg.tooltips=function(){$(".js-has-tooltip").hover(function(){var t=$(this).data("tooltip-content"),i=$(this).offset(),e='<div class="oe-tooltip" style="position:fixed; left:'+(i.left+20)+"px; top:"+(i.top+-10)+'px;">'+t+"</div>";$(this).data("tooltip",e),$("body").append(e)},function(){$("body").find(".oe-tooltip").remove()})};